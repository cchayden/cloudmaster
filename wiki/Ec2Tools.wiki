#summary Summary of EC2 Tools

= EC2 Tools =

All tools need AWS credentials, which they obtan either from environment variables or a configuration file.  See AwsSetup for information on how to set this up.

== Images ==
An image is a snapshot of a disk, ready to boot an EC2 instance.  Images are stored in S3 and registered with EC2.  Images are identified by an "ami-number".

=== list-images ===
{{{list-images [pattern]}}}

Lists all images known to EC2.  This takes a few seconds, at best.  If a pattern is given, only image names that match the pattern are displayed.

=== list-my-images ===
{{{list-my-images}}}

Lists all imagtes owned by the current account.  Usually much faster than {{{list-images}}}.
=== list-image ===
{{{list-image ami-number [attribute]}}}

Lists attribute information about the image (given its ami-number).  If attribute is omitted, then information about all attributes is displayed.
=== register-image ===
{{{register-image name}}}

Registers the image, given its name.  Ordinarily the name is a manifest, which is found in an S3 bucket. After this succeeds, you get an ami-number,  You can then start instances of this image using either its ami-number or its image name, using {{{start-image}}}.

=== deregister-image ===
{{{deregister-image ami-number | image-name}}}

Deregisters an image, given either its ami-number or its image name.  After this succeeds, the image no longer shows up under {{{list-images}}} and can no longer be started by {{{start-image}}}.

=== make-image-public ===
{{{make-image-public ami-number | image-name}}}

Makes an image public, so that it can be used by anyone.  After this, the image is still owned by you and still shows up in {{{limt-my-images}}} but it is also accessible to anyone else.  Make sure you don't store your private key on the image, since anyone will be able to log in with their keypair.


== Keypairs ==
Initially, you can log into an instance as root, given its DNS name, using a pre-arrangek key pair.  These key pairs are generated by EC2 and referred to by name.

When you start an instance, you can specify the keypair or keypairs to use.

=== list-keypairs ===
{{{list-keypairs}}}

Displays the name and signature of each keypair associated with the EC2 account.

=== create-keypair ===
{{{create-keypair name}}}

This creates a keypair of the given name and stores it in a file (of the same name) in the current directory.  You should handle this with care, since it allows people to log in to your instances.

=== delete-keypair ===
{{{delete-keypair name}}}

Deletes the keypair, making it impossible to use with newly-started instances.

== Security Groups ==
When instances are launched, Amazon provides a simple firewall policy limiting the ports that can be used to contact your instance, and who is allowed to use it.  These permissions are called security grousp, and these commands are used to build and manage the groups.

When you start an instance, you can specify the group to be used.

=== list-groups ===
{{{list-groups}}}

Display all groups belonging to the account, along with their rules.

=== list-group ===
{{{list-group name}}}

Lists the rules associated with the given group.

=== create-group ===
{{{create-group name desription}}}

Creates a security group with the given name.  A description must also be supplied.

=== add-ip-rule ===
{{{add-ip-rule group-name ip|tcp|icmp from-port to-port cdir}}}

Adds a new group rule, allowing traffic over the specified protocol on all ports numerically between from and to-port inclusive, from IP addresses matching cdir.  Cdir is a IP address mask, in the form of n.n.n.n/bits.  Only IP addresses matching this mask are allowed.  Use 0.0.0.0/0 to allow traffic from anywhere.

=== delete-group ===
{{{delete-group name}}}

Deletes the security group with the given name.

== Instances ==
Instances refers to virtual machines that have been started.  They go through a series of states as the boot up, eventually reachin the "running" state.  When an instance is stopped, it remains visible foq a few minutes, then it disappears.  Instances are identified by an "i-number".

=== list-instances ===
{{{list-instances}}}

Displays a summary of the existing instances.  Those in the running state also display their public DNS name.  You can use this name to log in, or to otherwise contact the instance.

=== list-instance ===
{{{list-instance i-number}}}

Display information about a given instance,  This information is more extensive than the summary information given be {{{list-instances}}}.

=== start-instance ===
{{{start-instance ami-number|image-name [security-group]}}}

Starts a new instance.  The image is given by an ami-number or an image name.  The security group can be given in the command, or in {{{AWS_GROUP}}}.  The key can be given by storing its pathname in the environment variable {{{AWS_KEY}}}.  If more than one image matches the image name, then they are displayed and you are prompted to choose one.

Charges start accruing after this succeeds.

=== stop-instance ===
{{{stop-instance i-number}}}

Stops the given intance.  All data on the virtual hard disk is lost.  Charges stop accruing when this succeeds.

== Remote Operations On Instances ==
The following operations allow you to log in, remotely execute commands, and copy files to and from the instance.  They are mostly implemented with an underlying ssh operation.

=== login-instance ===
{{{login-instance [i-number]}}}

Log into the instance as root.  If no ami number, then all instances are listed and you can choose which one to log in to.  If the instances is not running, it has no DNS name, and this command will fail.  The keypair to use is specified by the environment variable {{{AWS_KEY}}}.

=== wait-for-active-instance ===
{{{wait-for-active-instance i-number}}}

Waits until the instance is started and has a DNS name.  Useful in scripts to delay after an instance is started.  Note that after this returns, it is still impossible to log in through ssh for another 15 secons or so, because the ssh serers need time to start.

=== run-cmd-instance ===
{{{run-cmd-instance command [i-number]}}}

Run the given command as root on the given instance.  If no ami-number is give, then all instances are displayed and you can choose one. The result of the command is displayed as it executes.

=== copy-from-instance ===
{{{copy-from-instance local remote [i-number]}}}

Copies fles or directories from a local to a remote location.  If the instance is not given, the the instances are displayed and you can choose one.  

=== copy-to-instance ===
{{{copy-to-instance remote local [i-number]}}}

Copies fles or directories from a remote to a local location.  If the instance is not given, the the instances are displayed and you can choose one.  

=== reboot-instance ===
{{{reboot-instance i-number}}}

Reboot the given instance.  The instance is *not* stopped, and the hard disk contents are *not* lost.  But charges do not stop either.

=== get-console-instance ===
{{{get-console-instance [i-number]}}}

Get the contents of the system console of the given instance.  This is useful for diagnosing boot-time problems.

= See Also =

  * S3Tools
  * SqsTools
  * SqsTools